# Moodle with Terraform

Terraform code that implements Moodle using a VPC, with a private subnet, two public subnets, an Amazon Relational Database Service, an Elastic Load Balancer, an autoscaling group in the private subnet, a bastion host to access EC2 instances through SSH securely, two Route53 records (one for the Elastic Load Balancer and one for the database endpoint), a remote state storage, and an SSL certificate.

The terraform code runs inside a docker container that has all the necessary tools. You only have to pass your aws credentials, a S3 bucket and a key pair.

Documentation is automatic generated by terraform-docs in markdown format.

## Requirements

1.- You have to create an AWS S3 bucket to enable remote state storage.
https://docs.aws.amazon.com/AmazonS3/latest/user-guide/create-bucket.html

2.- You have to create a AWS EC2 Key to prove your identity when connecting to an instance.

https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html#having-ec2-create-your-key-pair

## Usage

1.- Run this command:

docker build \
-t moodlewithterraform \
--build-arg AWS_ACCESS_KEY_ID='<Your access key id>' \
--build-arg AWS_SECRET_ACCESS_KEY='<Your secret acces key>' \
--build-arg AWS_DEFAULT_REGION='us-east-1' \
--build-arg s3_bucket='<Your S3 Bucket (requirement 1)>' \
--build-arg key_pair='<Your Key Pair (requirement 2)>' \
 . && \
docker run -it --rm moodlewithterraform

A docker container will be created and a bash shell is ready to go.

2.- Run this command:

./run_task1.sh

3.- Enjoy!

4.- When you finish your review, run:

terraform destroy

to eliminate all created infraestructure in this demo.

5.- Run this command:

exit

to exit the docker container.
